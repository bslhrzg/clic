******************************************
******************************************
NF = 36, M = 18, Nimp = 2
******************************************
[[-0.75   0.     0.    ...  0.     0.     0.   ]
 [ 0.    -0.75   0.    ...  0.     0.     0.   ]
 [ 0.     0.    -0.75  ...  0.     0.103  0.   ]
 ...
 [ 0.     0.     0.    ...  1.5    0.     0.   ]
 [ 0.     0.     0.103 ...  0.     2.     0.   ]
 [ 0.     0.     0.    ...  0.     0.     2.   ]]
************
[[-0.75   0.     0.103  0.124  0.124  0.103  0.103  0.124  0.124  0.103  0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.    -0.75   0.     0.     0.     0.     0.     0.     0.     0.     0.103  0.124  0.124  0.103  0.103  0.124  0.124  0.103]
 [ 0.103  0.    -2.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.124  0.     0.    -1.5    0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.124  0.     0.     0.    -1.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.103  0.     0.     0.     0.    -0.5    0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.103  0.     0.     0.     0.     0.     0.5    0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.124  0.     0.     0.     0.     0.     0.     1.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.124  0.     0.     0.     0.     0.     0.     0.     1.5    0.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.103  0.     0.     0.     0.     0.     0.     0.     0.     2.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.     0.103  0.     0.     0.     0.     0.     0.     0.     0.    -2.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.     0.124  0.     0.     0.     0.     0.     0.     0.     0.     0.    -1.5    0.     0.     0.     0.     0.     0.   ]
 [ 0.     0.124  0.     0.     0.     0.     0.     0.     0.     0.     0.     0.    -1.     0.     0.     0.     0.     0.   ]
 [ 0.     0.103  0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.    -0.5    0.     0.     0.     0.   ]
 [ 0.     0.103  0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.5    0.     0.     0.   ]
 [ 0.     0.124  0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     1.     0.     0.   ]
 [ 0.     0.124  0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     1.5    0.   ]
 [ 0.     0.103  0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.     2.   ]]
h0_0 size:  (36, 36)
U_0 size:  (36, 36, 36, 36)
Going with Nelec_imp = 2, nbath = 16, Nelec = 18
imp_indices_full = [0, 1, 18, 19]
h0_0 = 
[[-0.75   0.     0.103 ...  0.     0.     0.   ]
 [ 0.    -0.75   0.    ...  0.     0.     0.   ]
 [ 0.103  0.    -2.    ...  0.     0.     0.   ]
 ...
 [ 0.     0.     0.    ...  1.     0.     0.   ]
 [ 0.     0.     0.    ...  0.     1.5    0.   ]
 [ 0.     0.     0.    ...  0.     0.     2.   ]]


--------------------------------------------------------------
Mean-Field Self-Consistent Procedure with block handling
--------------------------------------------------------------
[V1] mfscf proc with Ne=18, maxiter=100, alpha=0.2, threshold=1e-07, spinsym_only = False
[V1] Symmetry analysis found 4 blocks.
[V1] Found 1 unique groups of blocks.
[V1] Blocks: [[0, 2, 3, 4, 5, 6, 7, 8, 9], [1, 10, 11, 12, 13, 14, 15, 16, 17], [18, 20, 21, 22, 23, 24, 25, 26, 27], [19, 28, 29, 30, 31, 32, 33, 34, 35]]
[V1] Identical Groups (by block index): [[0, 1, 2, 3]]
[V1] iter 0, Tr(rho*h0) = -16.98382716
[V1] Ne = 18, initial tr(rho) = 18.00000000+0.00000000j
[V1] mixing parameter: α = 0.2
[V2] Number of non-zero U elements: 16
[V1] Iter         E_total          E_corr        ΔE_total
[V2] U is sparse, using nzU
[V1]    1    -15.42334740     -1.56047976      1.0154e+03
[V1]   10    -16.22927027     -0.36461072      1.7970e-02
[V1]   20    -16.29050024     -0.31887978      1.8088e-03
[V1]   30    -16.29695648     -0.31767866      1.9413e-04
[V1]   40    -16.29764963     -0.31764751      2.0845e-05
[V1]   50    -16.29772405     -0.31764671      2.2382e-06
[V1]   60    -16.29773204     -0.31764669      2.4029e-07
[V1] Converged in 64 iterations.
[V1] Final tr(rho) = 18.00000000+0.00000000j
[V2] Reordering final eigenvectors to spin-blocked convention...
hmf = 
[[-0.262  0.     0.103 ...  0.     0.     0.   ]
 [ 0.    -0.262  0.    ...  0.     0.     0.   ]
 [ 0.103  0.    -2.    ...  0.     0.     0.   ]
 ...
 [ 0.     0.     0.    ...  1.     0.     0.   ]
 [ 0.     0.     0.    ...  0.     1.5    0.   ]
 [ 0.     0.     0.    ...  0.     0.     2.   ]]
DEBUG, Nimp_sf = 4
hmf_ab = 
[[-0.262+0.j  0.   +0.j  0.   +0.j ...  0.   +0.j  0.   +0.j  0.   +0.j]
 [ 0.   +0.j -0.262+0.j  0.   +0.j ...  0.   +0.j  0.   +0.j  0.   +0.j]
 [ 0.   +0.j  0.   +0.j -0.262+0.j ...  0.   +0.j  0.103+0.j  0.   +0.j]
 ...
 [ 0.   +0.j  0.   +0.j  0.   +0.j ...  1.5  +0.j  0.   +0.j  0.   +0.j]
 [ 0.   +0.j  0.   +0.j  0.103+0.j ...  0.   +0.j  2.   +0.j  0.   +0.j]
 [ 0.   +0.j  0.   +0.j  0.   +0.j ...  0.   +0.j  0.   +0.j  2.   +0.j]]

--- Analyzed Structure ---
Found 4 blocks
Blocks: [[0, 4, 6, 8, 10, 12, 14, 16, 18], [1, 5, 7, 9, 11, 13, 15, 17, 19], [2, 20, 22, 24, 26, 28, 30, 32, 34], [3, 21, 23, 25, 27, 29, 31, 33, 35]]
Identical Groups (by block index): [[0, 1, 2, 3]]
[blocks] 4 blocks; identical groups: [[0, 1, 2, 3]]
[check] Tr rho = 17.999999999926, sum blocks = 16.000000000000, Nelec = 18
[leader block 0] size=9 Nimp_b=1 Nelec_b=4
DEBUG: C1 = 
[[ 1.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.    -0.138  0.414 -0.844 -0.311 -0.004  0.001  0.     0.   ]
 [ 0.    -0.233 -0.716 -0.479  0.451 -0.008  0.001  0.001  0.   ]
 [ 0.    -0.381 -0.461  0.128 -0.791 -0.016  0.002  0.002  0.   ]
 [ 0.    -0.882  0.322  0.203  0.271 -0.051  0.009  0.007 -0.004]
 [ 0.    -0.036  0.004  0.004  0.003  0.517 -0.435 -0.382  0.63 ]
 [ 0.    -0.031  0.003  0.003  0.002  0.71   0.568  0.411  0.057]
 [ 0.    -0.023  0.002  0.002  0.001  0.394 -0.64   0.285 -0.594]
 [ 0.    -0.016  0.001  0.001  0.001  0.265  0.279 -0.777 -0.498]]
DEBUG: C2 = 
[[1. 0. 0. 0. 0. 0. 0. 0. 0.]
 [0. 1. 0. 0. 0. 0. 0. 0. 0.]
 [0. 0. 1. 0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 1. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 1. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 1. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0. 0.]
 [0. 0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 0. 0. 1.]]
DEBUG: C3 = 
[[ 0.381 -0.925  0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.925  0.381  0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.     0.     1.     0.     0.     0.     0.     0.     0.   ]
 [ 0.     0.     0.     1.     0.     0.     0.     0.     0.   ]
 [ 0.     0.     0.     0.     1.     0.     0.     0.     0.   ]
 [ 0.     0.     0.     0.     0.     1.     0.     0.     0.   ]
 [ 0.     0.     0.     0.     0.     0.     1.     0.     0.   ]
 [ 0.     0.     0.     0.     0.     0.     0.     1.     0.   ]
 [ 0.     0.     0.     0.     0.     0.     0.     0.     1.   ]]
DEBUG: C4 = 
[[ 1.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.     1.     0.     0.     0.     0.     0.     0.     0.   ]
 [ 0.     0.    -0.51  -0.707  0.49   0.     0.     0.     0.   ]
 [ 0.     0.    -0.793  0.607  0.051  0.     0.     0.     0.   ]
 [ 0.     0.    -0.334 -0.363 -0.87   0.     0.     0.     0.   ]
 [ 0.     0.     0.     0.     0.    -0.953  0.26   0.065 -0.14 ]
 [ 0.     0.     0.     0.     0.     0.107 -0.148  0.047 -0.982]
 [ 0.     0.     0.     0.     0.     0.144  0.3    0.943  0.016]
 [ 0.     0.     0.     0.     0.     0.244  0.906 -0.323 -0.125]]
DEBUG: C_total = 
[[ 0.381 -0.925  0.     0.     0.     0.     0.     0.     0.   ]
 [-0.128 -0.053  0.563 -0.692  0.43   0.004 -0.001  0.    -0.   ]
 [-0.215 -0.089  0.594  0.052 -0.768  0.008 -0.002  0.    -0.   ]
 [-0.352 -0.145  0.397  0.691  0.469  0.016 -0.004  0.001 -0.   ]
 [-0.816 -0.336 -0.416 -0.203 -0.067  0.05  -0.016  0.005 -0.001]
 [-0.034 -0.014 -0.007 -0.001 -0.    -0.441  0.654 -0.551  0.27 ]
 [-0.028 -0.012 -0.004 -0.001 -0.    -0.543  0.276  0.442 -0.658]
 [-0.022 -0.009 -0.003 -0.    -0.    -0.548 -0.255  0.456  0.652]
 [-0.015 -0.006 -0.002 -0.    -0.    -0.456 -0.656 -0.542 -0.262]]
DEBUG: C_total_restored = 
[[ 1.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [-0.    -0.138  0.563 -0.692  0.43   0.004 -0.001  0.    -0.   ]
 [-0.    -0.233  0.594  0.052 -0.768  0.008 -0.002  0.    -0.   ]
 [ 0.    -0.381  0.397  0.691  0.469  0.016 -0.004  0.001 -0.   ]
 [ 0.    -0.882 -0.416 -0.203 -0.067  0.05  -0.016  0.005 -0.001]
 [ 0.    -0.036 -0.007 -0.001 -0.    -0.441  0.654 -0.551  0.27 ]
 [-0.    -0.031 -0.004 -0.001 -0.    -0.543  0.276  0.442 -0.658]
 [-0.    -0.023 -0.003 -0.    -0.    -0.548 -0.255  0.456  0.652]
 [-0.    -0.016 -0.002 -0.    -0.    -0.456 -0.656 -0.542 -0.262]]
h_block_final:
[[-0.262 -0.193  0.136 -0.     0.    -0.219  0.    -0.    -0.   ]
 [-0.193 -0.651  0.331  0.    -0.     0.09   0.    -0.    -0.   ]
 [ 0.136  0.331 -1.407  0.416 -0.     0.     0.     0.    -0.   ]
 [-0.     0.     0.416 -1.46   0.325  0.    -0.    -0.    -0.   ]
 [ 0.    -0.    -0.     0.325 -1.478 -0.     0.    -0.    -0.   ]
 [-0.219  0.09   0.     0.    -0.     1.256  0.515  0.    -0.   ]
 [ 0.     0.     0.    -0.     0.     0.515  1.248  0.477  0.   ]
 [-0.    -0.     0.    -0.    -0.     0.     0.477  1.246  0.365]
 [-0.    -0.    -0.    -0.    -0.    -0.     0.     0.365  1.245]]
C_block:
[[ 1.     0.     0.     0.     0.     0.     0.     0.     0.   ]
 [-0.    -0.138  0.563 -0.692  0.43   0.004 -0.001  0.    -0.   ]
 [-0.    -0.233  0.594  0.052 -0.768  0.008 -0.002  0.    -0.   ]
 [ 0.    -0.381  0.397  0.691  0.469  0.016 -0.004  0.001 -0.   ]
 [ 0.    -0.882 -0.416 -0.203 -0.067  0.05  -0.016  0.005 -0.001]
 [ 0.    -0.036 -0.007 -0.001 -0.    -0.441  0.654 -0.551  0.27 ]
 [-0.    -0.031 -0.004 -0.001 -0.    -0.543  0.276  0.442 -0.658]
 [-0.    -0.023 -0.003 -0.    -0.    -0.548 -0.255  0.456  0.652]
 [-0.    -0.016 -0.002 -0.    -0.    -0.456 -0.656 -0.542 -0.262]]
[sanity] ||h_final - C^† h C|| / ||h|| = 0.000e+00
hdc_ab = 
[[-0.262  0.     0.    ...  0.     0.     0.   ]
 [ 0.    -0.262  0.    ...  0.     0.     0.   ]
 [ 0.     0.    -0.262 ...  0.    -0.     0.   ]
 ...
 [ 0.     0.     0.    ...  1.246  0.     0.365]
 [ 0.     0.    -0.    ...  0.     1.245  0.   ]
 [ 0.     0.     0.    ...  0.365  0.     1.245]]
C_ab = 
[[ 1.     0.     0.    ...  0.     0.     0.   ]
 [ 0.     1.     0.    ...  0.     0.     0.   ]
 [ 0.     0.     1.    ...  0.     0.     0.   ]
 ...
 [ 0.     0.     0.    ...  0.456  0.     0.652]
 [ 0.     0.    -0.    ...  0.    -0.262  0.   ]
 [ 0.     0.     0.    ... -0.542  0.    -0.262]]
C = 
[[ 1.     0.     0.    ...  0.     0.     0.   ]
 [ 0.     1.     0.    ...  0.     0.     0.   ]
 [-0.     0.    -0.138 ...  0.     0.     0.   ]
 ...
 [ 0.     0.     0.    ...  0.276  0.442 -0.658]
 [ 0.     0.     0.    ... -0.255  0.456  0.652]
 [ 0.     0.     0.    ... -0.656 -0.542 -0.262]]
******************************************
h0_0 = 
[[-0.75   0.    -0.193 ...  0.     0.     0.   ]
 [ 0.    -0.75   0.    ...  0.     0.     0.   ]
 [-0.193  0.    -0.651 ...  0.     0.     0.   ]
 ...
 [ 0.     0.     0.    ...  1.248  0.477  0.   ]
 [ 0.     0.     0.    ...  0.477  1.246  0.365]
 [ 0.     0.     0.    ...  0.     0.365  1.245]]
h0_legacy = 
[[-0.75   0.     0.103 ...  0.     0.     0.   ]
 [ 0.    -0.75   0.    ...  0.     0.     0.   ]
 [ 0.103  0.    -2.    ...  0.     0.     0.   ]
 ...
 [ 0.     0.     0.    ...  1.     0.     0.   ]
 [ 0.     0.     0.    ...  0.     1.5    0.   ]
 [ 0.     0.     0.    ...  0.     0.     2.   ]]
Partitioning system: 2 impurity orbitals, 16 bath orbitals.
Generating basis for 2 electrons on impurity and 16 on bath.
Found 2 impurity configurations and 1 bath configurations.
Retaining only Sz=0 in starting basis
Generated a total of 2 unique starting determinants.
sb = [<SlaterDeterminant α=[0, 2, 3, 4, 5, 10, 11, 12, 13] β=[0, 2, 3, 4, 5, 10, 11, 12, 13]>, <SlaterDeterminant α=[1, 2, 3, 4, 5, 10, 11, 12, 13] β=[1, 2, 3, 4, 5, 10, 11, 12, 13]>]
DEBUG: build ham time = 0.00808095932006836
[init] dim=2  E0=-20.980972058366
blocks = [0.0], time block = 2.09808349609375e-05
apply_ham time = 5.412101745605469e-05
gen basis time = 0.00010800361633300781
sel basis time = 8.511543273925781e-05
Found 1 S_z blocks: [0.0]
  Processing Sz=0.0 block of size 22x22
DEBUG: build ham time = 0.007654905319213867
DEBUG: finished rearranging vectors
DEBUG: for basis size 22, ham diag time = 0.008119821548461914
[iter 0] dim=    22  Es=[-21.132204103906 -21.132204103906]  |dE0|=1.512e-01
blocks = [0.0], time block = 2.7179718017578125e-05
apply_ham time = 0.0002579689025878906
gen basis time = 0.0004241466522216797
sel basis time = 0.0003018379211425781
Found 1 S_z blocks: [0.0]
  Processing Sz=0.0 block of size 124x124
DEBUG: build ham time = 0.008018970489501953
DEBUG: finished rearranging vectors
DEBUG: for basis size 124, ham diag time = 0.08561515808105469
[iter 1] dim=   124  Es=[-21.154643811879 -21.154643811879]  |dE0|=2.244e-02
blocks = [0.0], time block = 0.00013113021850585938
apply_ham time = 0.001409769058227539
gen basis time = 0.0020618438720703125
sel basis time = 0.0011379718780517578
Found 1 S_z blocks: [0.0]
  Processing Sz=0.0 block of size 488x488
DEBUG: build ham time = 0.009498119354248047
DEBUG: finished rearranging vectors
DEBUG: for basis size 488, ham diag time = 0.10575318336486816
[iter 2] dim=   488  Es=[-21.158885905773 -21.158885898462]  |dE0|=4.242e-03
blocks = [0.0], time block = 0.0004570484161376953
apply_ham time = 0.005527019500732422
gen basis time = 0.007636070251464844
sel basis time = 0.0040051937103271484
Found 1 S_z blocks: [0.0]
  Processing Sz=0.0 block of size 1464x1464
DEBUG: build ham time = 0.012634992599487305
DEBUG: finished rearranging vectors
DEBUG: for basis size 1464, ham diag time = 0.16519784927368164
[iter 3] dim=  1464  Es=[-21.159615407866 -21.159615407864]  |dE0|=7.295e-04
blocks = [0.0], time block = 0.001336812973022461
apply_ham time = 0.01689600944519043
gen basis time = 0.02302098274230957
sel basis time = 0.009155035018920898
Found 1 S_z blocks: [0.0]
  Processing Sz=0.0 block of size 4092x4092
DEBUG: build ham time = 0.021009206771850586
DEBUG: finished rearranging vectors
DEBUG: for basis size 4092, ham diag time = 0.18343806266784668
[iter 4] dim=  4092  Es=[-21.159707064570 -21.159707064237]  |dE0|=9.166e-05
blocks = [0.0], time block = 0.0037610530853271484
apply_ham time = 0.045699119567871094
gen basis time = 0.06037306785583496
sel basis time = 0.020581960678100586
Found 1 S_z blocks: [0.0]
  Processing Sz=0.0 block of size 8470x8470
DEBUG: build ham time = 0.035515785217285156
DEBUG: finished rearranging vectors
DEBUG: for basis size 8470, ham diag time = 0.8968031406402588
[iter 5] dim=  8470  Es=[-21.159715745274 -21.159715745183]  |dE0|=8.681e-06
[conv] reached |dE| < 1e-05
Found 1 S_z blocks: [0.0]
  Processing Sz=0.0 block of size 8470x8470
DEBUG: build ham time = 0.03682303428649902
DEBUG: finished rearranging vectors
sci total time : 4.23679780960083
energies = [-21.16 -21.16], e0 = -21.15971574527364
len basis = 8470
len(basis(psis0)) = 8470
target_indices = [0, 1, 18, 19]
 Founds blocks : [[0], [1], [2], [3]]
  Symmetry: is_diagonal=True. Found 1 unique group(s) of blocks.
  Computing representative g_(0,0) via Scalar CF...
DEBUG: build ham time = 0.05163311958312988
DEBUG: build ham time = 0.06952381134033203
target_indices = [0, 1, 18, 19]
 Founds blocks : [[0], [1], [2], [3]]
  Symmetry: is_diagonal=True. Found 1 unique group(s) of blocks.
  Computing representative g_(0,0) via Scalar CF...
DEBUG: build ham time = 0.052139997482299805
DEBUG: build ham time = 0.06928491592407227
rdm : 
[[0.5+0.j 0. +0.j 0. +0.j 0. +0.j]
 [0. +0.j 0.5+0.j 0. +0.j 0. +0.j]
 [0. +0.j 0. +0.j 0.5+0.j 0. +0.j]
 [0. +0.j 0. +0.j 0. +0.j 0.5+0.j]]
impurity occupation: (2.0000033629661216+0j)
total occupation : (2.0000033629661216+0j)

Thermally-averaged calculation finished.
Data saved to 'dump/A_8'
